{"version":3,"sources":["app.js","index.js"],"names":["express","require","path","app","https","fs","options","key","readFileSync","cert","server","createServer","io","use","static","join","__dirname","get","req","res","sendFile","resolve","console","log","on","socket","of","sockets","size","message","roomId","to","emit","in","fetchSockets","then","clientCount","length","module","exports","port","listen"],"mappings":"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","file":"index.js","sourceRoot":"../src","sourcesContent":["const express = require('express');\r\nconst path = require('path');\r\nconst app = express();\r\nconst https = require('https');\r\nconst fs = require('fs');\r\n\r\nconst options = {\r\n    key: fs.readFileSync('key.pem'),\r\n    cert: fs.readFileSync('cert.pem')\r\n};\r\n\r\nconst server = https.createServer(options, app);\r\n\r\nconst io = require('socket.io')(server);\r\n\r\napp.use(express.static(path.join(__dirname, 'public')));\r\n\r\napp.get('/', (req,res)=>{\r\n    res.sendFile(path.resolve(__dirname, \"public\",\"index.html\"));\r\n})\r\n\r\n\r\n\r\nconsole.log(\"initing socket event handlers\");\r\n\r\nio.on('connection', socket => {\r\n    console.log('new connection');\r\n    console.log('total sockets connected: ' +  io.of(\"/\").sockets.size);\r\n\r\n    socket.on('message', (message, roomId) => {\r\n        socket.to(roomId).emit('message', message);\r\n    })\r\n\r\n    socket.on('join-room', roomId => {\r\n        console.log('new client joined room ' + roomId);\r\n\r\n        io.in(roomId).fetchSockets()\r\n            .then(sockets => {\r\n                const clientCount = sockets.length;\r\n                if (clientCount == 0) {\r\n                    console.log('creating room');\r\n\r\n                    socket.join(roomId);\r\n                    socket.emit('created', roomId);\r\n                } \r\n                else if (clientCount == 1) {\r\n                    console.log('2nd client joined');\r\n\r\n                    socket.to(roomId).emit('join', roomId);\r\n\r\n                    socket.join(roomId);\r\n                    socket.emit('joined', roomId);\r\n                }\r\n                else {\r\n                    console.log('Rejected a client, room full');\r\n\r\n                    socket.emit('full');\r\n                }\r\n            });\r\n    })\r\n    socket.on('disconnect', () => {\r\n        console.log(`a user disconnected, total sockets remaining: ${io.of(\"/\").sockets.size}`);\r\n    });\r\n})\r\n\r\n\r\n\r\n\r\nmodule.exports = server;","const app = require('./app');\r\n\r\nconst port = '8888'\r\n\r\napp.listen(port, '0.0.0.0', () => {\r\n  console.log(`Server is listening on port ${port}...`);\r\n});"]}